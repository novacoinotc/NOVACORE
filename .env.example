# ===========================================
# NOVACORE Environment Configuration
# ===========================================
# Copy this file to .env and fill in the actual values
# NEVER commit .env or actual credentials to the repository
#
# SECURITY CHECKLIST FOR PRODUCTION:
# [ ] Use strong unique passwords (20+ chars)
# [ ] Enable SSL on database connection (sslmode=require)
# [ ] Configure TRANSACTION_SIGNING_KEY for transaction integrity
# [ ] Use different secrets for NEXTAUTH_SECRET and WEBHOOK_SECRET
# [ ] Rotate RSA keys every 12 months
# [ ] Store ALL secrets in AWS Secrets Manager
# [ ] Verify OPM webhook IP whitelist (35.171.132.81)
# ===========================================

# Database Configuration (AWS RDS PostgreSQL)
# SECURITY: Always use SSL in production
DATABASE_URL="postgresql://user:password@host:5432/database?schema=public&sslmode=require"

# ===========================================
# OPM API Configuration (SPEI Integration)
# ===========================================
# Documentation: MI-OPM-2.5.pdf, Especificacion api.pdf

# API URL (server-side only - no NEXT_PUBLIC_ prefix for security)
# UAT (Pruebas): https://apiuat.opm.mx
# Production: https://api.opm.mx
OPM_API_URL=https://apiuat.opm.mx

# API Key - Get from OPM dashboard Integration tab
# Dashboard UAT: https://transfercld.com:10443/
# Dashboard Prod: https://mdo.opm.mx/
OPM_API_KEY=your_api_key_here

# RSA Private Key for signing orders (PEM format)
# Can be the raw PEM key or base64 encoded
# Download from OPM dashboard Integration tab (mds_keys/private_key)
OPM_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----
YOUR_PRIVATE_KEY_HERE
-----END RSA PRIVATE KEY-----"

# RSA Public Key for verifying webhooks (PEM format)
# Can be the raw PEM key or base64 encoded
# Download from OPM dashboard Integration tab (mds_keys/public_key)
OPM_PUBLIC_KEY="-----BEGIN RSA PUBLIC KEY-----
YOUR_PUBLIC_KEY_HERE
-----END RSA PUBLIC KEY-----"

# ===========================================
# Webhook Configuration
# ===========================================
# Configure these URLs in OPM dashboard Integration tab:
# - Webhook de abono entrante: https://your-domain.com/api/webhooks/opm/supply
# - Webhook de estatus de transaccion: https://your-domain.com/api/webhooks/opm/status
# - Webhook de recoleccion en efectivo: https://your-domain.com/api/webhooks/opm/cash

# Secret for webhook validation (recommended)
# Generate with: openssl rand -base64 32
WEBHOOK_SECRET=your_webhook_secret_here

# SECURITY: RSA signature validation for incoming webhooks
# Set to "true" because OPM does NOT provide their public key for webhook validation
# Security relies on IP whitelist (hardcoded OPM IPs) + webhook secret header
# If OPM ever provides their public key in the future, set to "false"
SKIP_WEBHOOK_SIGNATURE_VALIDATION=true

# ===========================================
# App Configuration
# ===========================================
NEXT_PUBLIC_APP_NAME=NOVACORE
NEXT_PUBLIC_APP_ENV=production
NODE_ENV=production

# ===========================================
# NextAuth Configuration
# ===========================================
# Generate with: openssl rand -base64 32
NEXTAUTH_SECRET=your_secret_key_minimum_32_characters
NEXTAUTH_URL=https://your-domain.com

# ===========================================
# Transaction Security
# ===========================================
# HMAC key for signing transactions (tamper detection)
# Generate with: openssl rand -base64 32
# SECURITY: Must be at least 32 characters
TRANSACTION_SIGNING_KEY=your_transaction_signing_key_minimum_32_chars

# Grace period in seconds before transfer is sent to OPM
# During this time, users can cancel the transfer
# Default: 8 seconds
GRACE_PERIOD_SECONDS=8

# ===========================================
# OPM Webhook Security (Additional Notes)
# ===========================================
# OPM's production IP for webhooks is HARDCODED in the code
# (35.171.132.81) - this cannot be changed via environment
# This is our primary security defense since OPM doesn't provide RSA keys
# OPM_WEBHOOK_IPS=35.171.132.81
